Bootstrap: localimage
From: conda_base_alphafold.sif

# Build instructions from
# https://github.com/kalininalab/alphafold_non_docker

%files
    launcher.sh /opt/launcher.sh
    test_gpu.sh /opt/test_gpu.sh

%post
    . /opt/miniconda3/etc/profile.d/conda.sh
    conda activate alphafold
    conda install -y -c conda-forge openmm==7.7.0 cudnn==8.3.2.44 cudatoolkit==11.5.1 pdbfixer==1.8.1
    conda install -y -c bioconda hmmer==3.3.2 hhsuite==3.3.0 kalign2==2.04

    cd /opt
    pip install -r alphafold/requirements.txt
    pip3 install --upgrade jax==0.4.6 jaxlib==0.4.6+cuda11.cudnn82 -f https://storage.googleapis.com/jax-releases/jax_cuda_releases.html
