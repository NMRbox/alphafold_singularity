Bootstrap: localimage
From: base.sif

%post
    # miniconda setup
    cd /opt/
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-$(uname -p).sh && bash Miniconda3-latest-Linux-$(uname -p).sh -b -p /opt/miniconda3
    . /opt/miniconda3/etc/profile.d/conda.sh

    # These lines are to ensure that python3.8 for arm is available
    conda config --add channels conda-forge
    conda update --all

    conda create --name alphafold python==3.8
    conda update -n base conda

    # alphafold setup
    cd /opt/
    git clone https://github.com/deepmind/alphafold.git #--branch v2.3.2
    cd alphafold
    git checkout 6a3af1adb3bbbc53562da100e3819b2fc882f915
    alphafold_path="/opt/alphafold"
    cd /opt
    wget -q -P alphafold/alphafold/common/ https://git.scicore.unibas.ch/schwede/openstructure/-/raw/7102c63615b64735c4941278d92b554ec94415f8/modules/mol/alg/src/stereo_chemical_props.txt
